---
title: 'Mini Project 1: Life Expectancy'
author: "Joe Stoica, Conor Devins"
date: "9/28/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache = TRUE)
library(tidyverse)
library(gapminder)
library(ggthemes)
library(broom)
```

```{r}
df <- gapminder
```

```{r}
df_2007 <- df %>% filter(year == 2007)
lo_s = loess(lifeExp ~ gdpPercap, data = df_2007)
```


```{r}
ggplot(augment(lo_s, data = df_2007), aes(x = gdpPercap, y = .fitted)) +
  geom_point(aes(y = lifeExp)) + 
  geom_line(color = "blue", size = 1)+
  theme_fivethirtyeight() +
  theme(axis.title = element_text()) +
  xlab("GDP") +
  ylab("Life Expectancy") +
  labs(title = "Life Expectancy Compared to GDP per capita in 2007") + 
  scale_x_continuous(breaks = seq(0,50000,5000))
```

The plot shows a very non-linear relationship with high variance on the right end
of the LOESS smoother, which essentially is a weighted least-squares regression
technique that fits a local polynomial to subsets of the data, which results in
a smooth curve. LOESS has two parameters, alpha and lambda, which represents the
span of the region and the degree of the local polynomial respectively. 

It seems that countries below about $4,000 GDP have the lowest life expectancy, but
countries over $5,000 seem to all be over 70 years and continues to increase 
steadidly to the higher ends of GDP, besides a few outliers. 

```{r}
ggplot(augment(lo_s, data = df_2007), aes(x = log(gdpPercap), y = .fitted)) +
  geom_point(aes(y = lifeExp)) + 
  geom_line(color = "blue", size = 1)+
  theme_fivethirtyeight() +
  theme(axis.title = element_text()) +
  xlab("log GDP") +
  ylab("Life Expectancy") +
  labs(title = "Life Expectancy Compared to log GDP per capita in 2007")
```

```{r, include=FALSE}
ggplot(augment(lo_s, data = df_2007), aes(x = log(gdpPercap), y = .resid)) +
  geom_point() + 
  geom_smooth() + 
  theme_fivethirtyeight() +
  theme(axis.title = element_text()) +
  xlab("log GDP") +
  ylab("Life Expectancy") +
  labs(title = "Life Expectancy Compared to log GDP per capita in 2007")
```

Examining the residual plot reveals that there is some slight variance in the tails
of the data, however the variance is consistent throughout the rest of the plot. 
The residuals also appear to fit around 0 fairly nicely. There might be some outliers
in mid-to-upper portion of our data, though.

```{r}
ggplot(augment(lo_s, data = df_2007), aes(x = gdpPercap, y = .fitted)) +
  geom_point(aes(y = lifeExp)) + 
  geom_line(color = "blue", size = 1)+
  facet_wrap(.~continent, scales = "free_x") +
  theme_fivethirtyeight() +
  theme(axis.title = element_text()) +
  xlab("GDP") +
  ylab("Life Expectancy") +
  labs(title = "Life Expectancy Compared to GDP per capita in 2007")
```

It appears that this pattern is varies across all of the continents. For Africa, 
the Americas, and Asia, the trend from above follows: countries with lower GDP 
typically has worse life expectancy, and as GDP increases, so does life expectancy.
However, Europe sees high life expectancy throughout their entire range. It is 
difficult to make any concrete conclusions about Oceania, though, because they 
only have two countries. It is difficult to tell if there are any additive or 
multiplicative shifts due to this variance in the trends.

***

```{r}
df %>% 
  ggplot(aes(year, lifeExp)) +
  facet_wrap(.~continent) +
  geom_point(alpha = 0.2 ) +
  geom_smooth() +
  theme_fivethirtyeight() +
  theme(axis.title = element_text()) +
  xlab("Year") +
  ylab("Life Expectancy") +
  labs(title = "Life Expectancy by Continent (1952 - 2007)")
```

Every country has seen an increse in life expectancy in this 55 year period. 
Asia has seen the biggest overall increase and is starting to catch up to the Americas.
Oceania and Europs see the highest overall life expectancy at the beginning and at the 
end of this period. Africa, unfortunately, started with the lowest and ended with 
the lowest, and seemed to have plateaued somewhere inbetween 1980 to 1990. Africa's
variance seemed to have increased in this time as well, which is suggestive of certain
countries increasing more than others. None of the changes appears to be perfectly 
linear, but most are pretty close, with only slight curvature.

This progression could potentially be explained by global advancements in healthcare technology
and improvements in public health. It appears that continents that started lower
are catching up to the continents with higher life expectancies. So maybe the higher countries 
can develop these new advances and let it trickle down to be adopted by lower countries.

***

Changes in the relationship between GDP and life expectancy over time:  How has the relationship between GDP and life expectancy changed in each continent?  Can changes in life expectancy be entirely explained by changes in GDP per capita?   Does it look like there’s a time effect on life expectancy in addition to a GDP effect? Has there been "convergence" in the sense that perhaps GDP and/or continent don’t matter as much as it used to?  Are there exceptions to the general patterns?

