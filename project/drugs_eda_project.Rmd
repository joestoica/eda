---
title: "EDA Project"
author: "Joe Stoica, Conor Devins, Geno Kim"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  pdf_document:
    fig_width: 6
    fig_height: 4
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      cache = TRUE, 
                      message = FALSE,
                      warning = FALSE)
library(tidyverse)
library(lubridate)
library(ggthemes)
library(ggmosaic)
library(VGAM)
```


```{r ggplot theme}
# Set global ggplot theme
theme_set(theme_fivethirtyeight() + theme(axis.title = element_text()))
```

# Statement of goals.
## What questions are you trying to address? 
Some preliminary questions 

### 1.	What is the relationship between perceived side effects and overall satisfaction? 

### 2.	What is the relationship between perceived effectiveness and overall satisfaction? 

### 3.	What is the relation between perceived side effects and perceived effectiveness? 
#### a.	Though intuitively one may assume that more severe side effects would be associated with lower perceived effectiveness, it is also possible that effectiveness-sideeffect trade-offs are nonetheless perceived as a net benefit to the patient (where perceived benefits of the drug for daily life quality outweigh their negative side effects). Are there certain classes of drugs or specific drugs where the  relationships are different or does it hold true across all drugs?

### 4. What is the breakdown of the types of drugs used for treating depression (or other mood disorders).

#### a. This can be a simple bar chart showing the relative proportions of serotonin-reuptake inhibiting drugs (SRIs), norepinephrine-mechanism drugs (NRIs), Amphetamines (AMP), etc…

### 5. How do certain classes of drugs compare in terms of their perceived side effects, effectiveness and overall satisfaction?

#### a. SRIs and NRIs are probably the most popular of options, but are they actually superior along   these dimensions of perception? 

#### b. Can probably do Multinomial regression to address this question; if we do this, may be worth excluding some drug classes that have very few cases, and focusing on those classes that represent a  sizeable portion of the data. These analyses are covered in Lecture 25, slide 28. 


## Why do you care?   

## Why should we care?

# Description of your data.
## In addition to graphical displays, this should include verbal descriptions of what your variables are, who the individuals in your data from, and how they were selected/sampled. If you have many variables, you don’t have to describe all of them, just pick out some key ones.

The data we chose to use is the Drug Review Dataset from the UCI Machine Learning
Repository. The data focuses on pharmaceutical drug users ratings and reviews of
certain drugs they've taken. 

The data was compiled by gathering the reviews from druglib.com, which is "a
comprehensive drug database organized by relevance to specific drugs." (TODO make footnote for http://www.druglib.com/). It allows people who have used a specific drug to rate 
the drug based on their experience. 

(TODO explain how we removed people and have that code)

(TODO change observations #) Our data has five columns with 369 different observations:

DrugName: the name of the drug

Satisfaction: Rating (10-point scale, 10 being highest satisfaction)

Effectiveness:
1 - Ineffective
2 - Marginally Effective
3 - Moderately Effective
4 - Considerably Effective
5 - Highly Effective


Side Effects: 
1 - Extremely Severe Side Effects
2 - Severe Side Effects
3 - Moderate Side Effects
4 - Mild Side Effects
5 - No Side Effects

Type: Chemical type of the drug  

# Answering your questions.
## This is the most important criterion. It will probably include (but is not limited to) fitting a statistical model or models of some kind, and showing that these models tell you something of interest. You should do the following (not necessarily in this order):

(TODO what's our main question)


```{r data import}
# From https://archive.ics.uci.edu/ml/datasets/Drug+Review+Dataset+%28Druglib.com%29#
#drugs <- read_csv("drugData.csv")
drugs_test <- read_csv(file = 'drugLibTest_raw.csv')
drugs_train <- read_csv(file = 'drugLibTrain_raw.csv')
drugs <- rbind(drugs_test, drugs_train) %>% as.tibble() 
```

1. filter all rows for which the condition is for anything related to “depression”
so basically just look for the string “depression” in that column where condition is listed.
this includes depression + any other comorbidities
2. delete the comments column where people describe their experience w/ the drug etc.
3. for the drug names (e.g. lexapro etc.) any drug that has a hyphenated add-on such as drugname-xr or whatever, just remove that hyphenated part so you’re just left with “drugname”, for the simplicity we’re gonna ignore different versions of the same drug (paxil-xr vs paxil)
just treat paxil-xr as belonging to paxil

and finally, the column that i added but was not part of the original data set was drug pharmacology (e.g. SRI, NRI, Amphetamines, etc.)

i basically had to manually make a table of contents for which family each drug name belonged to
but u won’t need to since you can find out that grouping from the csv file i uploaded
all those steps summarize what was done to get the data in the form it is now.

install.packages('SentimentAnalysis')
library(SentimentAnalysis)

```{r}
df_sent <- drugs %>%
  filter(str_detect(condition, 'epress')) %>%
  select(-c(sideEffectsReview, commentsReview, X1, condition)) %>% 
  # recode likert to 1-5 scale 
  mutate(effectiveness = case_when(
    effectiveness == "Highly Effective" ~ 5,
    effectiveness == "Marginally Effective" ~ 2, 
    effectiveness == "Moderately Effective" ~ 3, 
    effectiveness == "Considerably Effective" ~ 4,
    TRUE ~ 1)) %>% 
  mutate(sideEffects = case_when(
    sideEffects == "Extremely Severe Side Effects" ~ 1, 
    sideEffects == "Severe Side Effects" ~ 2, 
    sideEffects == "Moderate Side Effects" ~ 3, 
    sideEffects == "Mild Side Effects" ~ 4, 
    TRUE ~ 5)) %>% 
  mutate(urlDrugName = case_when(
    urlDrugName == "wellbutrin-xl" ~ "wellbutrin",
    urlDrugName == "wellbutrin-sr" ~ "wellbutrin",
    urlDrugName == "paxil-cr" ~ "paxil",
    urlDrugName == "effexor-xr" ~ "effexor",
    TRUE ~ urlDrugName
  ))
names(df_sent)[1] <- "drug"
colnames(drugs)
```
```{r}
getSent = function(review) {
  sentiment <- analyzeSentiment(review)
  sentBinary <- convertToBinaryResponse(sentiment)$SentimentGI
  return(as.character(sentBinary))
}

# This takes really long to execute so leave commented out. 
# for(i in 1:nrow(df_sent)){
#  df_sent$benefitsReview[i] <- getSent(df_sent$benefitsReview[i])
# }
```

```{r data cleaning}
df <- drugs %>% 
  # keep people who are depressed
  filter(str_detect(condition, 'epress')) %>% 
  # get rid of unnecessary columns
  select(-c(sideEffectsReview, benefitsReview, commentsReview, X1, condition)) %>% 
  # recode likert to 1-5 scale 
  mutate(effectiveness = case_when(
    effectiveness == "Highly Effective" ~ 5,
    effectiveness == "Marginally Effective" ~ 2, 
    effectiveness == "Moderately Effective" ~ 3, 
    effectiveness == "Considerably Effective" ~ 4,
    TRUE ~ 1)) %>% 
  mutate(sideEffects = case_when(
    sideEffects == "Extremely Severe Side Effects" ~ 1, 
    sideEffects == "Severe Side Effects" ~ 2, 
    sideEffects == "Moderate Side Effects" ~ 3, 
    sideEffects == "Mild Side Effects" ~ 4, 
    TRUE ~ 5)) %>% 
  mutate(urlDrugName = case_when(
    urlDrugName == "wellbutrin-xl" ~ "wellbutrin",
    urlDrugName == "wellbutrin-sr" ~ "wellbutrin",
    urlDrugName == "paxil-cr" ~ "paxil",
    urlDrugName == "effexor-xr" ~ "effexor",
    TRUE ~ urlDrugName
  ))
names(df)[1] <- "drug"
colnames(drugs)
```

```{r make drug table}
SRI_list <- c("Celexa",
              "Citalopram",
              "Lexapro",
              "Paxil",
              "Prozac",
              "Zoloft",
              "Sarafem",
              "Symbyax",
              "Desyrel",
              "Trazodone")
AAP_list = c("Abilify", "Zyprexa","seroquel")
AMP_list <- c("Adderall",
              "Dextroamphetamine",
              "Vyvanse",
              "ritalin")
OPD_list <-  c("buprenorphine", "tramadol")
NRI_list <- c("Concerta",
              "Wellbutrin",
              "Effexor",
              "Serzone",
              "Pristiq",
              "Cymbalta")
BNZ_list <- c("Diazepam",
              "Klonopin",
              "Valium",
              "Xanax")
TCA_list <-  c("Elavil",
               "nortriptyline",
               "Pamelor")
MOAI_list <- c("Emsam",
               "Nardil")
MISC_list <- c("Lamictal",
               "Lamotrigine",
               "Lithium-Carbonate",
               "Mirtazapine",
               "Gabapentine",
               "neurontin",
               "prempro",
               "remeron",
               "Sular",
               "synthroid",
               "tirosint",
               "topamax")
type_list <- c(rep("AAP", 3), rep("AMP", 4), rep("BNZ", 4), rep("MISC", 12), rep("MOAI", 2),
               rep("NRI", 6), rep("OPD", 2), rep("SRI", 10), rep("TCA", 3))
drug_list <- c(AAP_list, AMP_list, BNZ_list, MISC_list, MOAI_list, NRI_list, OPD_list, SRI_list, TCA_list)
drug_table <- data.frame(drug = tolower(drug_list), type = type_list)
# join drug data with drug type
df <- df %>% left_join(drug_table, by = "drug")
df <- df %>% 
  mutate(type = ifelse(type %in% c("SRI", "NRI"), as.character(type), "Other"))
```



```{r }
df %>% 
  ggplot(aes(factor(sideEffects), fill = factor(rating))) +
  geom_bar(position = "fill") +
  theme(legend.position = "top",
        legend.direction = "horizontal",
        panel.background = element_blank(),
        plot.background = element_blank(),
        legend.background = element_blank()) +
  guides(fill = guide_legend(title = "Satisfaction", reverse = TRUE, nrow = 1)) +
  ylab("Proportion") +
  xlab("Side Effects Ratings") + 
  coord_flip() +
  ggtitle("Drug Side Effects Ratings and Overall Satisfaction")+
  scale_fill_viridis_d()
```

The above plot shows that the worse the side effects are, the least satisfied the
subjects were. (TODO more explanation maybe)



```{r}
satis_perc <- df %>% 
  ggplot(aes(effectiveness, fill = factor(rating))) +
  geom_bar(position = "fill") +
  theme(legend.position = "top",
        legend.direction = "horizontal",
        plot.subtitle = element_text(size = 8, color = "black"),
        panel.background = element_blank(),
        plot.background = element_blank(),
        legend.background = element_blank()) +
  guides(fill = guide_legend(title = "Satisfaction", reverse = TRUE, nrow = 1)) +
  ylab("Proportion") +
  xlab("Effectiveness") + 
  labs(title = "How Drugs Effectiveness Affects Satisfaction",
       subtitle = "1 - Ineffective, 2 - Marginally Effective, 3 - Moderately Effective, 4 - Considerably Effective, 5 - Highly Effective") +
  coord_flip() + 
  scale_fill_viridis_d() +
  ggtitle("Perceived Drug Effectiveness and Overall Satisfaction") 

#ggsave(satis_perc, filename = "satis_perc.png")
```
The above plot shows that the more effective, the more satisfied the
subjects were. (TODO more explanation maybe)

```{r}
side_effects_perc <- df %>%
  ggplot(aes(effectiveness, fill = factor(sideEffects))) +
  geom_bar(position = "fill") + 
  theme(legend.position = "top",
        legend.direction = "horizontal",
        panel.background = element_blank(),
        plot.background = element_blank(),
        legend.background = element_blank()) +
  guides(fill = guide_legend(title = "Satisfaction", reverse = TRUE, nrow = 1)) +
  ylab("Proportion") +
  xlab("Effectiveness") + 
  coord_flip() +
  ggtitle("Perceived Drug Effectiveness and Side Effects") +
  scale_fill_viridis_d()

#ggsave(side_effects_perc, filename = "side_effects_perc.png")
```

### State answers to your questions;

### Describe how you came to these answers;

### Explore the implications to your answers. For example, if your answer is a non-trivial model, plot the fit and describe what’s going on in words.

# Identification of work left to do/limitations.
## It’s EDA, so we don’t require perfection. However, you should have a clear idea of what the imperfections in your work are (what doesn’t fit  well?   what  other  variables  would  you  really want  to  know?),  and  how  they  could potentially be addressed.


```{r make mosiac df}
# Set up data frame for mosaic plots
x <- df %>% 
  select(type, effectiveness, sideEffects, rating) %>%
  gather(key = "rating_type", value = "given_score", sideEffects, effectiveness, rating) %>% 
  group_by(type, rating_type, given_score) %>% 
  count()
names(x) = c("type", "rating_type", "given_score", "count")
x$type = factor(x$type, levels = c("NRI", "SRI", "Other"))
```

```{r drug type mosaic}
# Mosaic plot of user overall satisfaction with drug by drug type (SRI vs NRI)
x %>%
  filter(rating_type %in% c("rating")) %>%
  ggplot() +
  geom_mosaic(aes(product(type, rating_type),
                  weight = count,
                  fill = factor(given_score))) +
  theme_fivethirtyeight() +
  guides(fill = guide_legend("Rating", reverse = TRUE)) +
  coord_flip() +
  scale_fill_viridis_d() +
  theme(legend.position = "right", 
        legend.direction = "vertical",
        axis.text.y = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        plot.title = element_text(size = 14),
        panel.background = element_blank(),
        plot.background = element_blank(),
        legend.background = element_blank(),
        axis.text = element_text(size = 16)) +
  ggtitle("Overall Satsifaction By Drug Type")
```

Mosaic plot of user ratings of drug effectiveness and side effects by drug type (SRI vs NRIs)
```{r mosaic}
x %>% 
  ungroup() %>% 
  filter(rating_type %in% c("effectiveness", "sideEffects")) %>% 
  mutate(rating_type = case_when(
    rating_type == "effectiveness" ~ "User Rating of Effectiveness",
    TRUE ~ "User Rating of Side Effects")) %>% 
  ggplot() +
  geom_mosaic(aes(product(type, rating_type), 
                  weight = count, 
                  fill = factor(given_score)))+
  theme_fivethirtyeight() + 
  guides(fill = guide_legend("Rating",reverse = TRUE)) +
  coord_flip() + 
  facet_grid(. ~ rating_type) + 
  scale_fill_viridis_d() + 
  theme(legend.position = "right", 
        legend.direction = "vertical",
        axis.text.y = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        plot.background = element_blank(),
        legend.background = element_blank(),
        axis.text = element_text(size = 16),
        strip.background = element_blank()) + 
  ggtitle("Ratings of Effectiveness & Side Effects Across Drug Types")
```

```{r}
df %>%
  group_by(type) %>%
  count() %>%
  ggplot(aes(as.factor(type),n)) + 
  geom_bar(stat = "identity") +
  #theme_light(base_size = 20) +
  theme(panel.grid.major.x = element_blank()) +
  ylab("Count") +
  xlab("Drug Classification") 
```

```{r scatter plot}
df %>% 
  ggplot(aes(effectiveness, sideEffects, color = factor(rating))) +
  geom_jitter(alpha = 0.4, width = 0.1, height = 0.1) +
  # faceting doesn't really offer any additional insight
  #facet_grid(.~type) +
  xlab("Effectiveness Rating") +
  ylab("Side Effects Rating") +
  labs(color = "User Rating") +
  scale_color_viridis_d() + 
  theme(legend.position = "right",
        legend.direction = "vertical",
        plot.title = element_text(size=14)) +
  guides(colour = guide_legend(override.aes = list(alpha = 1, size = 2)),
         reverse = TRUE) +
  ggtitle("Effectiveness and Side Effects Rating with Overall User Rating")
```

```{r bar chart for counts}
temp <- df %>% 
  filter(type %in% c("SRI", "NRI")) %>% 
  select(drug, type) %>% 
  group_by(drug, type) %>% 
  count() %>% 
  ungroup()

# vec <- temp %>% 
#   arrange(n) %>% 
#   select(drug)
# dput(vec)
# I got it from the vec output, this is ugly 
temp$drug = factor(temp$drug, levels = c("concerta", "desyrel", "serzone", "symbyax", "trazodone", "pristiq", "sarafem", "celexa", "citalopram", "cymbalta",  "zoloft", "paxil", "prozac", "lexapro", "effexor", "wellbutrin"))

temp %>% 
  ggplot(aes(drug, n)) +
  geom_bar(stat = "identity") + 
  coord_flip() + 
  facet_wrap(.~type, scales = "free") +
  ylab("Count") +
  xlab("Drug Brand Name") + 
  #ggtitle("Which Drugs are Reviewed Most in NRI and SRI Groups?") +
  theme(plot.title = element_text(size = 14),
        panel.grid.major.y = element_blank()) 
  #theme_light(base_size = 16)

```


```{r model creation}
df <- df %>% as.tibble()
drugs_polr <- MASS::polr(factor(rating) ~ as.factor(effectiveness) + as.factor(sideEffects), data = df)
drugs_polr2 <- MASS::polr(factor(rating) ~ as.factor(effectiveness) + as.factor(sideEffects) + as.factor(type), data = df)

drugs_polr2 <- MASS::polr(factor(rating) ~ as.factor(effectiveness) + as.factor(sideEffects) + as.factor(type), data = df)

drugs_polr3 <- MASS::polr(factor(rating) ~ as.factor(effectiveness) + as.factor(sideEffects) + as.factor(drug), data = df)
```

I created three models all trying to predict rating. They all have side effects and effectiveness. The first model only uses those two, the second model takes into consideration drug type, and the third model takes into consideration the drug itself. The first model has the lowest Akaike information criterion (AIC). "[It] is an estimator of the relative quality of statistical models for a given set of data. Given a collection of models for the data, AIC estimates the quality of each model, relative to each of the other models. Thus, AIC provides a means for model selection.(stolen from wikipedia (https://en.wikipedia.org/wiki/Akaike_information_criterion)". So even though it doesnt have the lowest residual deviance, it is still the best model to use. Adding the sentiment analysis might improve it, however. 

```{r}
drugs.polr.df <- data.frame(model.frame(drugs_polr), fitted.values(drugs_polr))

drugs.polr.long <- drugs.polr.df %>% gather(factor.rating., probability, X1:X10) %>% 
  mutate(factor.rating. = substring(factor.rating., 2))

drugs.polr.long$factor.rating. <- factor(drugs.polr.long$factor.rating.,
                                 levels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"))

drugs.polr.long$as.factor.sideEffects.f <- factor(drugs.polr.long$as.factor.sideEffects., 
                                          levels = c("5","4","3","2","1"))

ordinal.plot <- drugs.polr.long %>%
  ggplot(aes(as.numeric(factor.rating.), probability, col = as.factor.sideEffects.f)) +
  geom_line() +
  geom_point() + 
  facet_grid(as.factor.sideEffects.f ~ as.factor.effectiveness.) +
  xlab("Overall Satisfaction Rating") + ylab("Probability") + 
  labs(title = "Ordinal Logistic Model Probabilities")+
  guides(color = guides(col=FALSE)) + 
  scale_colour_viridis_d() +
  scale_x_continuous(breaks = seq(0,10,2), sec.axis = sec_axis(~.*1, "Effectiveness")) + 
  scale_y_continuous(sec.axis = sec_axis(~.*1, "Side Effects")) +
  theme(plot.subtitle = element_text(size = 8),
        axis.text.y.right = element_blank(),
        axis.text.x.top = element_blank()) 
#ggsave(ordinal.plot, filename="ordinal_plot.png")
```


```{r}
recode = function(x) {
  if(x < 3) {
    return("Poor")
  } else if(x == 3 | x == 4) {
    return("Fair")
  } else {
    return("Excellent")
  }
}

df2 <- df
for(i in 1:nrow(df2)) {
  #df2$effectiveness[i] = recode(df2$effectiveness[i])
  df2$sideEffects[i] = recode(df2$sideEffects[i])
}
```

Multinomial Logit Model #1 (2 predictors): SatisfactionRating ~ Effectiveness + SideEffects
```{r}
m1 <- VGAM::vglm(factor(rating) ~ as.factor(effectiveness) + as.factor(sideEffects), data = df, family = "multinomial")

m1.df <- data.frame(model.frame(m1), fitted.values(m1))

m1.long <- m1.df %>% gather(factor.rating., probability, X1:X10) %>% 
  mutate(factor.rating. = substring(factor.rating., 2))

m1.long$factor.rating. <- factor(m1.long$factor.rating., 
                                 levels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"))

m1.long$as.factor.sideEffects.f <- factor(m1.long$as.factor.sideEffects., 
                                          levels = c("5","4","3","2","1"))

multi.plot <- m1.long %>%
  ggplot(aes(as.numeric(factor.rating.), probability, col = as.factor.sideEffects.f)) +
  geom_line() +
  geom_point() + 
  facet_grid(as.factor.sideEffects.f ~ as.factor.effectiveness.) +
  xlab("Overall Satisfaction Rating") + ylab("Probability") + 
  labs(title = "Multinomial Logistic Model Probabilities")+
  guides(color = guides(col=FALSE)) + 
  scale_colour_viridis_d() +
  scale_x_continuous(breaks = seq(0,10,2), sec.axis = sec_axis(~.*1, "Effectiveness")) + 
  scale_y_continuous(sec.axis = sec_axis(~.*1, "Side Effects")) +
  theme(plot.subtitle = element_text(size = 8),
        axis.text.y.right = element_blank(),
        axis.text.x.top = element_blank()) 

# m1.long %>% 
#   mutate(as.factor.effectiveness. = paste0("(E = ", as.factor.effectiveness.),
#          as.factor.sideEffects. = paste0("SE = ",as.factor.sideEffects., ")")) %>%
#   unite(col = unite, c(as.factor.effectiveness., as.factor.sideEffects.), sep = ", ") %>% 
#   ggplot(aes(factor.rating., probability)) + 
#   geom_point() + 
#   geom_line() + 
#   facet_wrap(. ~ unite) +
#   xlab("Rating") +
#   ylab("Probability")

# ggsave(multi.plot, filename="multiplot.png")
```

Multinomial Logit Model #2 (3 Predictors): SatisfactionRating ~ Effectiveness + SideEffects + DrugType
```{r}
# m2 <- VGAM::vglm(factor(rating) ~ as.factor(effectiveness) + as.factor(sideEffects) + as.factor(type), data = df, family = "multinomial")
# 
# m2.df <- data.frame(model.frame(m2), fitted.values(m2))
# m2.long <- m2.df %>% gather(factor.rating., probability, X1:X10) %>% 
#   mutate(factor.rating. = substring(factor.rating., 2))
# 
# m2.long$factor.rating. <- factor(m2.long$factor.rating., levels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"
# ))
# 
# m2.long %>%
#   mutate(as.factor.effectiveness. = paste0("(E = ", as.factor.effectiveness.),
#          as.factor.sideEffects. = paste0("SE = ",as.factor.sideEffects., ")")) %>%
#   unite(col = unite, c(as.factor.effectiveness., as.factor.sideEffects.), sep = ", ") %>%
#   ggplot(aes(x = factor.rating., y = probability, col = as.factor.type.)) +
#   geom_point() +
#   facet_wrap(. ~ unite) +
#   theme(legend.position = "right",
#         legend.direction = "vertical") +
#   xlab("Overall Satisfaction Rating") + 
#   ylab("Probability") +
#   guides(color = guide_legend("Drug Type"))
```

Multinomial Logit Model #3 (3 Predictors): SatisfactionRating ~ Effectiveness + SideEffects + DrugBrand
```{r}
#m3 <- VGAM::vglm(factor(rating) ~ as.factor(effectiveness) + as.factor(sideEffects) + as.factor(drug), data = df, family = "multinomial")
```


Plot multinomial model fits with fewer category levels
```{r}
# m.df2 <- VGAM::vglm(factor(rating) ~ as.factor(effectiveness) + as.factor(sideEffects), data = df2, family = "multinomial")
# 
# summary(m.df2)
# 
# m.df2 <- data.frame(model.frame(m.df2), fitted.values(m.df2))
# m.df2.long <- m.df2 %>% gather(factor.rating., probability, X1:X10) %>%
#   mutate(factor.rating. = substring(factor.rating., 2))
# 
# m.df2.long$factor.rating. <- factor(m.df2.long$factor.rating., levels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"
# ))
# 
# levels(m.df2.long$as.factor.effectiveness.) <- c("Ineffective","Marginally \nEffective","Moderately \nEffective","Considerably \nEffective","Highly Effective")
# 
# m.df2.long %>% 
#   #mutate(as.factor.effectiveness. = paste0(as.factor.effectiveness.)) %>%
#   #as.factor.sideEffects. = paste0("SE = ",as.factor.sideEffects., ")")) %>%
#   #unite(col = unite, c(as.factor.effectiveness., as.factor.sideEffects.), sep = ", ") %>% 
#   ggplot(aes(as.numeric(factor.rating.), probability, col = as.factor.sideEffects.)) + 
#   geom_point() + 
#   geom_line() +
#   facet_grid(as.factor.sideEffects.~ as.factor.effectiveness.) +
#   xlab("Overall Satisfaction Rating") +
#   ylab("Probability") + 
#   theme()+
#   guides(color = FALSE) + 
#   scale_color_viridis_d() +
#   scale_x_continuous(breaks = seq(0,10,2))
```

Multinomial logit model 1 and 2 not very different based on AIC (1380.239 vs 1383.26 respectively), whereas model 3 has lowest deviance but considerably higher AIC (1879.28). Could go with m1, since it has lowest AIC.

